<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>실전! 스프링 데이터 JPA | Today kiyeoneee Learned</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="What kiyeoneee learned everyday">
    <link rel="preload" href="/TIL/assets/css/0.styles.25cf7e1a.css" as="style"><link rel="preload" href="/TIL/assets/js/app.14df79b1.js" as="script"><link rel="preload" href="/TIL/assets/js/2.dce8ba1c.js" as="script"><link rel="preload" href="/TIL/assets/js/63.01eebdae.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.4f5ca765.js"><link rel="prefetch" href="/TIL/assets/js/11.8c375806.js"><link rel="prefetch" href="/TIL/assets/js/12.b481e600.js"><link rel="prefetch" href="/TIL/assets/js/13.f20868f4.js"><link rel="prefetch" href="/TIL/assets/js/14.41e7de9c.js"><link rel="prefetch" href="/TIL/assets/js/15.0e8a7359.js"><link rel="prefetch" href="/TIL/assets/js/16.203af499.js"><link rel="prefetch" href="/TIL/assets/js/17.063a3e76.js"><link rel="prefetch" href="/TIL/assets/js/18.97a8642a.js"><link rel="prefetch" href="/TIL/assets/js/19.402f271c.js"><link rel="prefetch" href="/TIL/assets/js/20.7018a74a.js"><link rel="prefetch" href="/TIL/assets/js/21.374cbc95.js"><link rel="prefetch" href="/TIL/assets/js/22.b10e5b32.js"><link rel="prefetch" href="/TIL/assets/js/23.8c73a2d0.js"><link rel="prefetch" href="/TIL/assets/js/24.a6b3b327.js"><link rel="prefetch" href="/TIL/assets/js/25.67310368.js"><link rel="prefetch" href="/TIL/assets/js/26.0cc3dc23.js"><link rel="prefetch" href="/TIL/assets/js/27.37dbddf6.js"><link rel="prefetch" href="/TIL/assets/js/28.25bf1a71.js"><link rel="prefetch" href="/TIL/assets/js/29.5178dc1b.js"><link rel="prefetch" href="/TIL/assets/js/3.54a487f9.js"><link rel="prefetch" href="/TIL/assets/js/30.900f1a49.js"><link rel="prefetch" href="/TIL/assets/js/31.5acadd72.js"><link rel="prefetch" href="/TIL/assets/js/32.32847f7d.js"><link rel="prefetch" href="/TIL/assets/js/33.d04d65df.js"><link rel="prefetch" href="/TIL/assets/js/34.a72ae435.js"><link rel="prefetch" href="/TIL/assets/js/35.161fd7dc.js"><link rel="prefetch" href="/TIL/assets/js/36.754771e8.js"><link rel="prefetch" href="/TIL/assets/js/37.e070245d.js"><link rel="prefetch" href="/TIL/assets/js/38.06a44a05.js"><link rel="prefetch" href="/TIL/assets/js/39.275c570e.js"><link rel="prefetch" href="/TIL/assets/js/4.30442eb7.js"><link rel="prefetch" href="/TIL/assets/js/40.d597ea7b.js"><link rel="prefetch" href="/TIL/assets/js/41.245be6d0.js"><link rel="prefetch" href="/TIL/assets/js/42.12baffdd.js"><link rel="prefetch" href="/TIL/assets/js/43.86f1dc16.js"><link rel="prefetch" href="/TIL/assets/js/44.db7e6df7.js"><link rel="prefetch" href="/TIL/assets/js/45.203b2bc7.js"><link rel="prefetch" href="/TIL/assets/js/46.e9df3ac1.js"><link rel="prefetch" href="/TIL/assets/js/47.deadd21a.js"><link rel="prefetch" href="/TIL/assets/js/48.b70a2df0.js"><link rel="prefetch" href="/TIL/assets/js/49.1a4d181d.js"><link rel="prefetch" href="/TIL/assets/js/5.a34725ae.js"><link rel="prefetch" href="/TIL/assets/js/50.fa9d44cb.js"><link rel="prefetch" href="/TIL/assets/js/51.3202ad00.js"><link rel="prefetch" href="/TIL/assets/js/52.a6b1fe41.js"><link rel="prefetch" href="/TIL/assets/js/53.dd35c8d1.js"><link rel="prefetch" href="/TIL/assets/js/54.44b419f9.js"><link rel="prefetch" href="/TIL/assets/js/55.e2e2942a.js"><link rel="prefetch" href="/TIL/assets/js/56.fc1b4e3e.js"><link rel="prefetch" href="/TIL/assets/js/57.3aad11c0.js"><link rel="prefetch" href="/TIL/assets/js/58.fcd4daa5.js"><link rel="prefetch" href="/TIL/assets/js/59.d043979e.js"><link rel="prefetch" href="/TIL/assets/js/6.a0757fc0.js"><link rel="prefetch" href="/TIL/assets/js/60.58261ba7.js"><link rel="prefetch" href="/TIL/assets/js/61.3e59b22b.js"><link rel="prefetch" href="/TIL/assets/js/62.b1ac5ae1.js"><link rel="prefetch" href="/TIL/assets/js/64.5c3d4686.js"><link rel="prefetch" href="/TIL/assets/js/65.1c655cd7.js"><link rel="prefetch" href="/TIL/assets/js/7.112c04ff.js"><link rel="prefetch" href="/TIL/assets/js/8.130adf09.js"><link rel="prefetch" href="/TIL/assets/js/9.b12d813d.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.25cf7e1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today kiyeoneee Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/kiyeoneee" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://kyeoneee.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Tech Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/kiyeoneee" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://kyeoneee.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Tech Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Books</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/TIL/book/clean-code" class="sidebar-heading clickable open"><span>Clean Code</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/book/clean-code/2-의미있는-이름.html" class="sidebar-link">2장. 의미있는 이름</a></li><li><a href="/TIL/book/clean-code/3-함수.html" class="sidebar-link">3장. 함수</a></li><li><a href="/TIL/book/clean-code/4-주석.html" class="sidebar-link">4장. 주석</a></li><li><a href="/TIL/book/clean-code/5-형식-맞추기.html" class="sidebar-link">5장. 형식 맞추기</a></li><li><a href="/TIL/book/clean-code/6-객체와-자료-구조.html" class="sidebar-link">6장. 객체와 자료 구조</a></li><li><a href="/TIL/book/clean-code/7-오류-처리.html" class="sidebar-link">7장. 오류 처리</a></li><li><a href="/TIL/book/clean-code/8-경계.html" class="sidebar-link">8장. 경계</a></li><li><a href="/TIL/book/clean-code/9-단위테스트.html" class="sidebar-link">9장. 단위 테스트</a></li><li><a href="/TIL/book/clean-code/10-클래스.html" class="sidebar-link">10장. 클래스</a></li><li><a href="/TIL/book/clean-code/11-시스템.html" class="sidebar-link">11장. 시스템</a></li><li><a href="/TIL/book/clean-code/12-창발성.html" class="sidebar-link">12장. 창발성</a></li><li><a href="/TIL/book/clean-code/14-점진적-개선.html" class="sidebar-link">14장. 점진적 개선</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="실전-스프링-데이터-jpa"><a href="#실전-스프링-데이터-jpa" class="header-anchor">#</a> 실전! 스프링 데이터 JPA</h1> <blockquote><p><strong>url</strong> : https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-JPA-%EC%8B%A4%EC%A0%84/dashboard/
<strong>강사</strong> : 김영한</p></blockquote> <h1 id="_0-스프링-데이터-jpa-소개"><a href="#_0-스프링-데이터-jpa-소개" class="header-anchor">#</a> 0. 스프링 데이터 JPA 소개</h1> <br> <h1 id="_1-프로젝트-환경설정"><a href="#_1-프로젝트-환경설정" class="header-anchor">#</a> 1. 프로젝트 환경설정</h1> <h2 id="_2-라이브러리-살펴보기"><a href="#_2-라이브러리-살펴보기" class="header-anchor">#</a> 2. 라이브러리 살펴보기</h2> <ul><li>spring-boot-starter-data-jpa
<ul><li>hibernate-core : 객체 관계 매핑 프레임워크</li> <li>spring-boot-starter-aop : spring core, hibernate 등의 의존성 포함</li> <li>spring-boot-starter-jdbc : db connection pool 등</li></ul></li></ul> <br> <h1 id="_4-쿼리-메소드-기능"><a href="#_4-쿼리-메소드-기능" class="header-anchor">#</a> 4. 쿼리 메소드 기능</h1> <h2 id="_1-메소드-이름으로-쿼리-생성"><a href="#_1-메소드-이름으로-쿼리-생성" class="header-anchor">#</a> 1. 메소드 이름으로 쿼리 생성</h2> <h3 id="순수-jpa-repository"><a href="#순수-jpa-repository" class="header-anchor">#</a> 순수 JPA Repository</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Chap4Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsernameAndAgeGreaterThan</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Chap4Member m where m.username = :username and m.age &gt; :age&quot;</span><span class="token punctuation">)</span>  
            <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>  
            <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span>  
            <span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><h3 id="spring-data-jpa-repository"><a href="#spring-data-jpa-repository" class="header-anchor">#</a> Spring Data JPA Repository</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Chap4MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsernameAndAgeGreaterThan</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>메서드 이름으로 쿼리를 생성</p></li> <li><p>위의 메서드는 <code>select m from Chap4Member m where m.username = :username and m.age &gt; :age</code> 와 동일하며, 메서드의 매개변수로 넘어온 것으로 파라미터를 대신할 수 있음</p></li> <li><p>메서드 이름 중 Entity의 필드명을 기반으로 쿼리를 생성하기 때문에 필드명을 주의해야 함
필드명을 잘못 입력 혹은 변경시 컴파일 시점에<code>org.springframework.data.mapping.PropertyReferenceException: No property username2 found for type Member! Did you mean 'username'?</code> 이러한 에러와 함께 에러 확인이 가능함</p></li></ul> <h3 id="spring-data-jpa가-제공하는-쿼리-메소드-기능"><a href="#spring-data-jpa가-제공하는-쿼리-메소드-기능" class="header-anchor">#</a> Spring Data JPA가 제공하는 쿼리 메소드 기능</h3> <p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation" target="_blank" rel="noopener noreferrer">쿼리 생성 규칙 공식 문서<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>를 참고</p> <ul><li>조회
<ul><li>find...By ,read...By ,query...By get...By,</li> <li>... 자리에는 식별하기 위한 내용이 들어가도 됨(아무거나 들어가도 됩니다.)</li></ul></li> <li>COUNT
<ul><li>count...By 반환타입 long</li></ul></li> <li>EXISTS
<ul><li>exists...By 반환타입 boolean</li></ul></li> <li>삭제
<ul><li>delete...By, remove...By 반환타입 long</li></ul></li> <li>DISTINCT
<ul><li>findDistinct, findMemberDistinctBy</li></ul></li> <li>LIMIT
<ul><li>findFirst3, findFirst, findTop, findTop3</li></ul></li></ul> <p>쿼리 메소드는 편하긴 하지만, 조건이 많아지면 메서드 명이 길어지는 상황이 발생함. 이를 다양하게 해결하는 방법들 : NamedQuery, QueryDSL 등</p> <br> <h2 id="_2-jpa-namedquery"><a href="#_2-jpa-namedquery" class="header-anchor">#</a> 2. JPA NamedQuery</h2> <h3 id="namedquery-어노테이션으로-쿼리-정의"><a href="#namedquery-어노테이션으로-쿼리-정의" class="header-anchor">#</a> <code>@NamedQuery</code> 어노테이션으로 쿼리 정의</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>  
<span class="token annotation punctuation">@NamedQuery</span><span class="token punctuation">(</span>  
        name<span class="token operator">=</span><span class="token string">&quot;Member.findByUsername&quot;</span><span class="token punctuation">,</span>  
        query<span class="token operator">=</span><span class="token string">&quot;select m from Member m where m.username = :username&quot;</span>  
<span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Chap4Member</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
<span class="token punctuation">}</span>
</code></pre></div><h3 id="쿼리-사용"><a href="#쿼리-사용" class="header-anchor">#</a> 쿼리 사용</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberRepository</span> <span class="token punctuation">{</span>  
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>   
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> resultList <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createNamedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;Member.findByUsername&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Member</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>   
    <span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre></div><h3 id="springdata-jpa로-namedquery-사용"><a href="#springdata-jpa로-namedquery-사용" class="header-anchor">#</a> SpringData JPA로 NamedQuery 사용</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
	<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Member.findByUsername&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 주석처리해도 동작 가능  </span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// query에 parameter가 존재할 때 @Param 어노테이션으로 명확하게 명시 필요  </span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>@Query</code>어노에티션을 작성하지 않더라도 spring data Jpa가 <code>도메인 클래스 + .(점) + 메서드 이름&quot;</code>으로 Named 쿼리를 찾아서 실행하므로 생략 가능</li> <li>실행할 NamedQuery가 없는 경우(매칭되는 쿼리가 없는 경우) 메서드 이름으로 쿼리 생성 전략을 사용</li></ul> <h4 id="namedquery의-장점"><a href="#namedquery의-장점" class="header-anchor">#</a> NamedQuery의 장점?</h4> <ul><li>정적 쿼리이므로 어플리케이션 로딩 시점에 파싱을 진행해 버그 발견 가능</li></ul> <br> <h2 id="_3-query-리포지토리-메소드에-쿼리-정의하기"><a href="#_3-query-리포지토리-메소드에-쿼리-정의하기" class="header-anchor">#</a> 3. @Query, 리포지토리 메소드에 쿼리 정의하기</h2> <p>NamedQuery의 장점을 가지면서 Repository 클래스 내에 쿼리를 정의</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m where m.username= :username and m.age = :age&quot;</span><span class="token punctuation">)</span>   
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li>NamedQuery의 장점과 마찬가지로 <strong>애플리케이션 실행 시점에 오타 등의 오류 발견 가능</strong></li></ul> <br> <h2 id="_4-query-값-dto-조회하기"><a href="#_4-query-값-dto-조회하기" class="header-anchor">#</a> 4. @Query, 값, DTO 조회하기</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
   <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select m.username from Member m&quot;</span><span class="token punctuation">)</span>  
 <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUsernameList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><h3 id="dto로-직접-조회"><a href="#dto로-직접-조회" class="header-anchor">#</a> DTO로 직접 조회</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>  <span class="token comment">// 실제 서비스에서는 Data는 꼭 필요할 때만 쓰도록  </span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberDto</span> <span class="token punctuation">{</span>  
  <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>  
  <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>  
  <span class="token keyword">private</span> <span class="token class-name">String</span> teamName<span class="token punctuation">;</span>  
    
  <span class="token keyword">public</span> <span class="token class-name">MemberDto</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> teamName<span class="token punctuation">)</span> <span class="token punctuation">{</span>   
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>  
    <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>  
    <span class="token keyword">this</span><span class="token punctuation">.</span>teamName <span class="token operator">=</span> teamName<span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
	<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select new study.datajpa.repository.MemberDto(m.id, m.username,  t.name) from Member m join m.team t&quot;</span><span class="token punctuation">)</span>  
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberDto</span><span class="token punctuation">&gt;</span></span> <span class="token function">findMemberDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li>DTO로 직접 조회하기 위해서는 new 명령어를 꼭 사용</li> <li>DTO에 쿼리에 맞는 생성자가 존재해야 함</li></ul> <br> <h2 id="_4-파라미터-바인딩"><a href="#_4-파라미터-바인딩" class="header-anchor">#</a> 4. 파라미터 바인딩</h2> <ul><li>위치 기반 - 위치 변경시 버그 발생 가능성이 높으므로 이름 기반 사용이 더욱 용이</li> <li>이름 기반</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> m <span class="token keyword">from</span> Member m <span class="token keyword">where</span> m<span class="token punctuation">.</span>username <span class="token operator">=</span> ?<span class="token number">0</span> <span class="token comment">//위치 기반   </span>
<span class="token keyword">select</span> m <span class="token keyword">from</span> Member m <span class="token keyword">where</span> m<span class="token punctuation">.</span>username <span class="token operator">=</span> :name <span class="token comment">//이름 기반</span>
</code></pre></div><h4 id="파라미터-바인딩"><a href="#파라미터-바인딩" class="header-anchor">#</a> 파라미터 바인딩</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>   
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m where m.username = :name&quot;</span><span class="token punctuation">)</span>  
  <span class="token class-name">Member</span> <span class="token function">findMembers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><h4 id="컬렉션-파라미터-바인딩"><a href="#컬렉션-파라미터-바인딩" class="header-anchor">#</a> 컬렉션 파라미터 바인딩</h4> <p>Collection 타입으로 in 절에 여러 값 바인딩 가능</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m where m.username in :names&quot;</span><span class="token punctuation">)</span>  
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByNames</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;names&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> names<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><br> <h2 id="_5-반환-타입"><a href="#_5-반환-타입" class="header-anchor">#</a> 5. 반환 타입</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//컬렉션  </span>
<span class="token class-name">Member</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//단건  </span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//단건 Optional</span>
</code></pre></div><h4 id="조회-결과가-많거나-없는-경우"><a href="#조회-결과가-많거나-없는-경우" class="header-anchor">#</a> 조회 결과가 많거나 없는 경우?</h4> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token class-name">Member</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;AAA&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token class-name">Member</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;AAA&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
      <span class="token comment">// 데이터가 없는 경우 empty collection 반환  </span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> lisetResult <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findListByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;aebesd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">assertThat</span><span class="token punctuation">(</span>lisetResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">assertThat</span><span class="token punctuation">(</span>lisetResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasSize</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
      <span class="token comment">// 데이터가 없는 경우 null 반환  </span>
      <span class="token class-name">Member</span> singleResult <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findMemberByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;aebesd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">assertThat</span><span class="token punctuation">(</span>singleResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
      <span class="token comment">// Optional이 실무 개발시 null 체크 등 불필요한 코드를 줄이기 용이함  </span>
      <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> optionalResult <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findOptionalByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;aebesd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">assertThat</span><span class="token punctuation">(</span>optionalResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        
      <span class="token comment">// 단건 조회를 의도하였으나 DB에는 데이터가 2건이 있으므로  </span>
      <span class="token comment">// javax.persistence.NonUniqueResultException 예외 발생  </span>
			memberRepository<span class="token punctuation">.</span><span class="token function">findMemberByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;AAA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>컬렉션</li> <li>결과 없음: 빈 컬렉션 반환</li> <li>단건 조회
<ul><li>결과 없음: null 반환<br>
SpringData JPA 내부에서 호출하는 JPQL의 <code>Query.getSingleResult()</code>메서드를 호출하여 결과가 없는 경우 <code>javax.persistence.NoResultException</code>을 발생시키는데, JPA가 이를 래핑하여 null을 반환</li> <li>결과가 2건 이상: <code>javax.persistence.NonUniqueResultException</code> 예외 발생</li></ul></li></ul> <br> <h2 id="_6-순수-jpa-페이징과-정렬"><a href="#_6-순수-jpa-페이징과-정렬" class="header-anchor">#</a> 6. 순수 JPA 페이징과 정렬</h2> <h3 id="jpa-페이징-레파지토리-코드"><a href="#jpa-페이징-레파지토리-코드" class="header-anchor">#</a> JPA 페이징 레파지토리 코드</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
	<span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m where m.age = :age order by m.username desc&quot;</span><span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">setFirstResult</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">setMaxResults</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">totalCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
	<span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;select count(m) from Member m where m.age = :age&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">getSingleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><h4 id="jpa-페이징-테스트-코드"><a href="#jpa-페이징-테스트-코드" class="header-anchor">#</a> JPA 페이징 테스트 코드</h4> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paging</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token comment">// given  </span>
        memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member1&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member2&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member3&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member4&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member5&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> limit <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  
  
        <span class="token comment">// when  </span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> members <span class="token operator">=</span> memberJpaRepository<span class="token punctuation">.</span><span class="token function">findByPage</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">long</span> totalCount <span class="token operator">=</span> memberJpaRepository<span class="token punctuation">.</span><span class="token function">totalCount</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">// then  </span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>members<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">assertThat</span><span class="token punctuation">(</span>totalCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>해당 코드에서는 없지만 실무에서 사용하기 위해서는 total page, 마지막 페이지 여부, 최초 페이지 여부 등이 함께 추가되면 좋음</li></ul> <br> <h2 id="_7-스프링-데이터-jpa-페이징과-정렬"><a href="#_7-스프링-데이터-jpa-페이징과-정렬" class="header-anchor">#</a> 7. 스프링 데이터 JPA 페이징과 정렬</h2> <h3 id="페이징과-정렬-파라미터"><a href="#페이징과-정렬-파라미터" class="header-anchor">#</a> 페이징과 정렬 파라미터</h3> <p>디비의 종류에 상관없이 두가지 인터페이스로 페이징을 공통화 시킴</p> <ul><li><code>org.springframework.data.domain.Sort</code> : 정렬 기능</li> <li><code>org.springframework.data.domain.Pageable</code> : 페이징 기능 (내부에 Sort 포함)</li></ul> <h3 id="특별한-반환-타입"><a href="#특별한-반환-타입" class="header-anchor">#</a> 특별한 반환 타입</h3> <p>totalCount가 없는 타입 (eg. 인스타그램과 같은 동적 페이징 서비스의 경우 사용)</p> <ul><li><code>org.springframework.data.domain.Page</code> : totalCount 포함 (0부터 시작)</li> <li><code>org.springframework.data.domain.Slice</code> : totalCount 불포함 다음 페이지만 확인 가능(내부적 으로 limit + 1조회)</li> <li><code>List</code> (자바 컬렉션): totalCount 없이 결과만 반환</li></ul> <h3 id="페이징과-정렬-사1용-예제"><a href="#페이징과-정렬-사1용-예제" class="header-anchor">#</a> 페이징과 정렬 사1용 예제</h3> <h5 id="page-사용-예제-정의-코드"><a href="#page-사용-예제-정의-코드" class="header-anchor">#</a> Page 사용 예제 정의 코드</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
  <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">//페이징 조건과 정렬 조건 설정  </span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  <span class="token comment">//given</span>
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member1&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member2&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member3&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member4&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member5&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
	<span class="token comment">//when  </span>
	<span class="token class-name">PageRequest</span> pageRequest <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token class-name">Direction</span><span class="token punctuation">.</span>DESC<span class="token punctuation">,</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findByAge</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
	<span class="token comment">//then  </span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> content <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//조회된 데이터  </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//조회된 데이터 수  </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//전체 데이터   </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//페이지 번호  </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//전체 페이지 번호  </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">isFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//첫번째 항목인가?  </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//다음 페이지가 있는가?  </span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>Pagable</code> 인터페이스를 사용할 때는 구현체인 <code>org.springframework.data.domain.PageRequest</code> 객체 사용</li> <li>PageRequest.of(현재 페이지, 조회할 데이터 수, option - 정렬 정보)</li> <li>Page는 0부터 시작</li></ul> <h3 id="count-쿼리-분리"><a href="#count-쿼리-분리" class="header-anchor">#</a> Count 쿼리 분리</h3> <p>join과 같이 복잡한 쿼리의 경우 totalCount 결과 값은 동일하지만 성능에 영향이 있을 수 있음<br>
이러한 경우 데이터 추출 쿼리와 countQuery를 분리해주는게 좋음</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> “select m from <span class="token class-name">Member</span> m”<span class="token punctuation">,</span> 
       countQuery <span class="token operator">=</span> “select <span class="token function">count</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>username<span class="token punctuation">)</span> from <span class="token class-name">Member</span> m”<span class="token punctuation">)</span>  <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findMemberAllCountBy</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="페이지를-유지하면서-엔티티를-dto로-변환하기"><a href="#페이지를-유지하면서-엔티티를-dto로-변환하기" class="header-anchor">#</a> 페이지를 유지하면서 엔티티를 DTO로 변환하기</h3> <p>Entity를 외부에 노출시키면 수정 발생 시 API Client들에게 장애를 일으킬 수 있으므로 꼭 DTO를 노출시켜야 함</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findByAge</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberDto</span><span class="token punctuation">&gt;</span></span> dtoPage <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>m <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">MemberDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><br> <h2 id="_8-벌크성-수정-쿼리"><a href="#_8-벌크성-수정-쿼리" class="header-anchor">#</a> 8. 벌크성 수정 쿼리</h2> <p>다량의 데이터를 동일한 값으로 수정하는 등의 작업을 수행하는 쿼리</p> <h3 id="jpa를-사용한-벌크성-수정-쿼리"><a href="#jpa를-사용한-벌크성-수정-쿼리" class="header-anchor">#</a> JPA를 사용한 벌크성 수정 쿼리</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bulkAgePlus</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">int</span> resultCount <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>
<span class="token string">&quot;update Member m set m.age = m.age + 1 where m.age &gt;= :age&quot;</span><span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
  <span class="token keyword">return</span> resultCount<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token annotation punctuation">@Test</span>   
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bulkUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>  
  <span class="token comment">//given  </span>
  memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member1&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member2&quot;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member3&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member4&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberJpaRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member5&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
  <span class="token comment">//when  </span>
  <span class="token keyword">int</span> resultCount <span class="token operator">=</span> memberJpaRepository<span class="token punctuation">.</span><span class="token function">bulkAgePlus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
  <span class="token comment">//then  </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>resultCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>
</code></pre></div><h3 id="springdata-jpa를-사용한-벌크성-수정-쿼리"><a href="#springdata-jpa를-사용한-벌크성-수정-쿼리" class="header-anchor">#</a> SpringData JPA를 사용한 벌크성 수정 쿼리</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Modifying</span> <span class="token comment">// executeUpdate 설정 역할의 어노테이션  </span>
<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;update Member m set m.age = m.age + 1 where m.age &gt;= :age&quot;</span><span class="token punctuation">)</span>  
<span class="token keyword">int</span> <span class="token function">bulkAgePlus</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token annotation punctuation">@Test</span>  
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bulkUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>  
  <span class="token comment">//given  </span>
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member1&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member2&quot;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member3&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member4&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  memberRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;member5&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
	<span class="token comment">//when  </span>
	<span class="token keyword">int</span> resultCount <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">bulkAgePlus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
	<span class="token comment">//then  </span>
  <span class="token function">assertThat</span><span class="token punctuation">(</span>resultCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>@Modifying</code> 어노테이션 - 벌크성 수정, 삭제 쿼리에 꼭 사용
<ul><li>누락시 exception 발생 -  <code>org.hibernate.hql.internal.QueryExecutionRequestException: Not supported for DML operations</code></li></ul></li> <li>벌크성 쿼리를 실행하고 나서 영속성 컨텍스트 초기화
<ul><li><code>@Modifying(clearAutomatically = true)</code> - default : false</li> <li>옵션이 없는 경우 쿼리 실행 후 <code>findById</code>로 조회 시 영속성 컨텍스트에 있는 엔티티의 상태와 DB의 상태가 다를 수 있 -&gt; <strong>쿼리 실행 후 바로 조회해야 할 땐 영속성 컨텍스트 초기화</strong></li></ul></li></ul> <br> <h2 id="_9-entitygraph"><a href="#_9-entitygraph" class="header-anchor">#</a> 9. @EntityGraph</h2> <ul><li>@ManyToOne(fetch = FetchType.LAZY)
<ul><li>연관관계가 있는 데이터를 무조건 가져오는 것이 아니라, 처음에는 가짜 객체로 세팅하고 이후에 실제 사용될 때 쿼리를 날려 데이터를 가져오는 것</li> <li>n + 1 문제<br>
하나의 쿼리에 n번의 추가 쿼리가 발생하게 됨</li> <li>이를 해결하기 위한 개념이 EntityGraph</li></ul></li></ul> <p>연관된 엔티티들을 SQL 한번에 조회하는 방법</p> <h3 id="jpql-fetch-join"><a href="#jpql-fetch-join" class="header-anchor">#</a> JPQL fetch join</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m left join fetch m.team&quot;</span><span class="token punctuation">)</span>  
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findMemberFetchJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>단점 : 쿼리를 문자열로 적어줘야 하므로 스킴 변경등의 상황이 발생했을 때 수정해야 하는 부분이 많음</li></ul> <h3 id="entitygraph"><a href="#entitygraph" class="header-anchor">#</a> EntityGraph</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>  
<span class="token annotation punctuation">@EntityGraph</span><span class="token punctuation">(</span>attributePaths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;team&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">//JPQL + 엔티티 그래프   </span>
<span class="token annotation punctuation">@EntityGraph</span><span class="token punctuation">(</span>attributePaths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;team&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m&quot;</span><span class="token punctuation">)</span>   
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findMemberEntityGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment">// 전체조회가 아닌 경우에도 사용 가능  </span>
<span class="token annotation punctuation">@EntityGraph</span><span class="token punctuation">(</span>attributePaths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;team&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span>
</code></pre></div><ul><li><p>LEFT OUTER JOIN 사용<br>
쿼리의 로그를 보면 아래와 같음</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span>  
		membe0_<span class="token punctuation">.</span>member_id <span class="token keyword">as</span> member_i1_2_0_<span class="token punctuation">,</span>  
		team1_<span class="token punctuation">.</span>team_id <span class="token keyword">as</span> team_id1_3_1_<span class="token punctuation">,</span>  
		membe0_<span class="token punctuation">.</span>age <span class="token keyword">as</span> age2_2_0_<span class="token punctuation">,</span>  
		membe0_<span class="token punctuation">.</span>team_id <span class="token keyword">as</span> team_id4_2_0_<span class="token punctuation">,</span>  
		membe0_<span class="token punctuation">.</span>username <span class="token keyword">as</span> username3_2_0_<span class="token punctuation">,</span>
		team1_<span class="token punctuation">.</span>name <span class="token keyword">as</span> name2_3_1_ 
<span class="token keyword">from</span>
	  member membe0_ 
	<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span>
		team team1_ 
			<span class="token keyword">on</span> membe0_<span class="token punctuation">.</span>team_id<span class="token operator">=</span>team1_<span class="token punctuation">.</span>team_id
</code></pre></div></li></ul> <h3 id="namedentitygraph-사용-방법"><a href="#namedentitygraph-사용-방법" class="header-anchor">#</a> NamedEntityGraph 사용 방법</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NamedEntityGraph</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Member.all&quot;</span><span class="token punctuation">,</span> attributeNodes <span class="token operator">=</span> <span class="token annotation punctuation">@NamedAttributeNode</span><span class="token punctuation">(</span><span class="token string">&quot;team&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@Entity</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
  
<span class="token annotation punctuation">@EntityGraph</span><span class="token punctuation">(</span><span class="token string">&quot;Member.all&quot;</span><span class="token punctuation">)</span>   
<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m&quot;</span><span class="token punctuation">)</span>  
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findMemberEntityGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div> <br> <h2 id="jpa-hint-lock"><a href="#jpa-hint-lock" class="header-anchor">#</a> JPA Hint &amp; Lock</h2> <p>SQL Hint 와 동일하지 X, JPA 구현체에게 제공하는 힌트</p> <h3 id="쿼리-힌트-사용"><a href="#쿼리-힌트-사용" class="header-anchor">#</a> 쿼리 힌트 사용</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@QueryHints</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token annotation punctuation">@QueryHint</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;org.hibernate.readOnly&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token class-name">Member</span> <span class="token function">findReadOnlyByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>실무에서는 대용량의 조회에 이슈가 생기는 경우는 앞단에 캐시를 두는게 훨씬 효율적일 수 있음</li></ul> <h3 id="lock"><a href="#lock" class="header-anchor">#</a> Lock</h3> <p>DB의 Lock 기능을 JPA가 지원</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Lock</span><span class="token punctuation">(</span><span class="token class-name">LockModeType</span><span class="token punctuation">.</span>PESSIMISTIC_WRITE<span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>org.springframework.data.jpa.repository.Lock</code> JPA가 사용하는 기능임</li> <li>실시간 트래픽이 많은 경우 성능저하를 일으킬 수 있으므로 조심히 사용</li></ul> <br> <h1 id="_5-확장-기능"><a href="#_5-확장-기능" class="header-anchor">#</a> 5. 확장 기능</h1> <h2 id="_1-사용자-정의-리포지토리-구현"><a href="#_1-사용자-정의-리포지토리-구현" class="header-anchor">#</a> 1. 사용자 정의 리포지토리 구현</h2> <ul><li>스프링 데이터 JPA 리포지토리는 인터페이스만 정의하고 구현체는 스프링이 자동 생성</li> <li>다양한 이유로 인터페이스의 메서드를 직접 구현하고 싶다면?
<ul><li>JPA 직접 사용( EntityManager )</li> <li>스프링 JDBC Template 사용</li> <li>MyBatis 사용</li> <li>데이터베이스 커넥션 직접 사용</li> <li><strong>Querydsl 사용</strong> : 가장 높은 비율</li></ul></li></ul> <h3 id="사용자-정의-인터페이스와-구현-클래스"><a href="#사용자-정의-인터페이스와-구현-클래스" class="header-anchor">#</a> 사용자 정의 인터페이스와 구현 클래스</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepositoryCustom</span> <span class="token punctuation">{</span>  
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findMemberCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token comment">// 네이밍 규칙을 꼭 맞춰줘야 함 (인터페이스+Impl)  </span>
<span class="token comment">// 그래야 스프링이 실제 구현체를 찾을 수 있음  </span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberRepositoryImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MemberRepositoryCustom</span> <span class="token punctuation">{</span>  
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EntityManager</span> em<span class="token punctuation">;</span>  
  <span class="token annotation punctuation">@Override</span>  
  <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">findMemberCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;select m from Member m&quot;</span><span class="token punctuation">)</span>   
      <span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>  
  
<span class="token comment">// 사용자 정의 인터페이스를 상속받도록 하여 기존 레파지토리와 함께 사용</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span>  
  		<span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">MemberRepositoryCustom</span> <span class="token punctuation">{</span>  
<span class="token punctuation">}</span>  
</code></pre></div><p><strong>사용자 정의 구현 클래스</strong></p> <ul><li>규칙: <strong>레파지토리 인터페이스 이름 + Impl</strong></li> <li>스프링 데이터 JPA가 인식해서 스프링 빈으로 등록</li></ul> <h3 id="impl-대신-다른-이름으로-변경하고-싶으면"><a href="#impl-대신-다른-이름으로-변경하고-싶으면" class="header-anchor">#</a> Impl 대신 다른 이름으로 변경하고 싶으면?</h3> <ul><li><p>XML 설정</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span>repositories base<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">=</span><span class="token string">&quot;study.datajpa.repository&quot;</span> repository<span class="token operator">-</span>impl<span class="token operator">-</span>postfix<span class="token operator">=</span><span class="token string">&quot;Impl&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>  
</code></pre></div></li> <li><p>JavaConfig 설정</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableJpaRepositories</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;study.datajpa.repository&quot;</span><span class="token punctuation">,</span>  
                           repositoryImplementationPostfix <span class="token operator">=</span> <span class="token string">&quot;Impl&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <blockquote><p>Custom에 단순히 화면에 보여지는 repository와 비즈니스 로직을 가지는 repository을 모두 custom에 때려넣다 보면 클래스가 너무 비대해질 수 있음<br>
이러한 경우 추후 유지보수 비용이 늘어날 수도 있으므로 실무에서는 이러한 요소들을 고려하여 클래스를 잘 분리해야 함</p></blockquote> <br> <h2 id="_2-auditing"><a href="#_2-auditing" class="header-anchor">#</a> 2. Auditing</h2> <h3 id="엔티티를-생성-변경할-때-변경한-사람과-시간을-추적하기-위한-데이터"><a href="#엔티티를-생성-변경할-때-변경한-사람과-시간을-추적하기-위한-데이터" class="header-anchor">#</a> 엔티티를 생성, 변경할 때 변경한 사람과 시간을 추적하기 위한 데이터</h3> <p>데이터의 정합성이 깨지거나 하는 등의 경우 추적을 용이하게 해주는 데이터</p> <ul><li>등록일</li> <li>수정일</li> <li>등록자</li> <li>수정자</li></ul> <h3 id="순수-jpa-사용"><a href="#순수-jpa-사용" class="header-anchor">#</a> 순수 JPA 사용</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@MappedSuperclass</span>  
<span class="token annotation punctuation">@Getter</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpaBaseEntity</span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  
  <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createdDate<span class="token punctuation">;</span>  
  <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updatedDate<span class="token punctuation">;</span>  
    
  <span class="token annotation punctuation">@PrePersist</span>  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prePersist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token class-name">LocalDateTime</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    createdDate <span class="token operator">=</span> now<span class="token punctuation">;</span>  
    updatedDate <span class="token operator">=</span> now<span class="token punctuation">;</span>  
	<span class="token punctuation">}</span>  
    
	<span class="token annotation punctuation">@PreUpdate</span>  
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  	updatedDate <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Member</span> <span class="token keyword">extends</span> <span class="token class-name">JpaBaseEntity</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
</code></pre></div><h3 id="jpa-주요-이벤트-어노테이션"><a href="#jpa-주요-이벤트-어노테이션" class="header-anchor">#</a> JPA 주요 이벤트 어노테이션</h3> <ul><li>@PostLoad: 해당 엔티티를 새로 불러오거나 refresh 한 이후</li> <li>@PrePersist: 해당 엔티티를 저장하기 이전</li> <li>@PostPersist: 해당 엔티티를 저장한 이후</li> <li>@PreUpdate: 해당 엔티티를 업데이트 하기 이전</li> <li>@PostUpdate: 해당 엔티티를 업데이트 한 이후</li> <li>@PreRemove: 해당 엔티티를 삭제하기 이전</li> <li>@PostRemove: 해당 엔티티를 삭제한 이후</li></ul> <h3 id="springdata-jpa-사용"><a href="#springdata-jpa-사용" class="header-anchor">#</a> SpringData JPA 사용</h3> <h4 id="설정"><a href="#설정" class="header-anchor">#</a> 설정</h4> <ul><li><code>@EnableJpaAuditing</code> -&gt; SpringBoot 설정 클래스에 적용</li> <li><code>@EntityListeners(AuditingEntityListener.class)</code> -&gt; Auditing 엔티티 클래스에 적용</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableJpaAuditing</span>  
<span class="token annotation punctuation">@SpringBootApplication</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PracticeSpringJpaApplication</span> <span class="token punctuation">{</span>  
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
<span class="token punctuation">}</span>  
  
<span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  
<span class="token annotation punctuation">@MappedSuperclass</span>  
<span class="token annotation punctuation">@Getter</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Chap5BaseEntity</span> <span class="token punctuation">{</span>  
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
<span class="token punctuation">}</span>
</code></pre></div><h3 id="spring-data-auditing-적용"><a href="#spring-data-auditing-적용" class="header-anchor">#</a> Spring Data Auditing 적용</h3> <p>하나의 클래스에서 등록시간, 수정시간, 등록자, 수정자를 다 구현할 수 있지만<br>
실무에서는 등록자, 수정자가 불필요한 클래스가 존재할 수 있으므로 나누어서 구현해주는 방법이 더 유용</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>   
<span class="token annotation punctuation">@MappedSuperclass</span>  
<span class="token annotation punctuation">@Getter</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseTimeEntity</span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@CreatedDate</span>  
  <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  
  <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createdDate<span class="token punctuation">;</span>  
    
  <span class="token annotation punctuation">@LastModifiedDate</span>  
  <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> lastModifiedDate<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseEntity</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTimeEntity</span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@CreatedBy</span>  
  <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  
  <span class="token keyword">private</span> <span class="token class-name">String</span> createdBy<span class="token punctuation">;</span>  
    
  <span class="token annotation punctuation">@LastModifiedBy</span>  
  <span class="token keyword">private</span> <span class="token class-name">String</span> lastModifiedBy<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>모든 엔티티에 설정해주기 귀찮은 경우 JPA spec에 있는 기능을 이용하여 전체 적용도 가능<br>
아래와 같은 <code>META-INF/orm.xml</code> 파일 생성</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entity-mappings</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/persistence/orm<span class="token punctuation">&quot;</span></span>
                 <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
                 <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://xmlns.jcp.org/xml/ns/persistence/ orm http://xmlns.jcp.org/xml/ns/persistence/orm_2_2.xsd<span class="token punctuation">&quot;</span></span>  
                 <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2.2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  
  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence-unit-metadata</span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence-unit-defaults</span><span class="token punctuation">&gt;</span></span>  
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entity-listeners</span><span class="token punctuation">&gt;</span></span>  
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entity-listener</span>                      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.data.jpa.domain.support.AuditingEntityListener<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entity-listeners</span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence-unit-defaults</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence-unit-metadata</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entity-mappings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="등록자-수정자를-처리해주는-auditoraware-스피링-빈-등록"><a href="#등록자-수정자를-처리해주는-auditoraware-스피링-빈-등록" class="header-anchor">#</a> 등록자, 수정자를 처리해주는 AuditorAware 스피링 빈 등록</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableJpaAuditing</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PracticeSpringJpaApplication</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    

  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">AuditorAware</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">auditorProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>실무에서는 세션 정보 또는 스프링 시큐리티 로그인 정보에서 ID를 받음</li> <li>저장시점에 저장데이터만 입력하고 싶으면 <code>@EnableJpaAuditing(modifyOnCreate = false)</code> 옵션을 사용</li></ul> <br> <h2 id="_3-web-확장-도메인-클래스-컨버터"><a href="#_3-web-확장-도메인-클래스-컨버터" class="header-anchor">#</a> 3. Web 확장 - 도메인 클래스 컨버터</h2> <p>HTTP 파라미터로 넘어온 엔티티의 아이디(PK)로 객체를 찾아서 바인딩<br>
PK가 외부에 노출되기 때문에 권장하지는 않음</p> <h4 id="도메인-클래스-컨버터-사용-전"><a href="#도메인-클래스-컨버터-사용-전" class="header-anchor">#</a> 도메인 클래스 컨버터 사용 전</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberController</span> <span class="token punctuation">{</span>  
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MemberRepository</span> memberRepository<span class="token punctuation">;</span>  
     
  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/members/{id}&quot;</span><span class="token punctuation">)</span>  
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">findMember</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token class-name">Member</span> member <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> member<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre></div><h4 id="도메인-클래스-컨버터-사용-후"><a href="#도메인-클래스-컨버터-사용-후" class="header-anchor">#</a> 도메인 클래스 컨버터 사용 후</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>  
<span class="token annotation punctuation">@RequiredArgsConstructor</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberController</span> <span class="token punctuation">{</span>  
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MemberRepository</span> memberRepository<span class="token punctuation">;</span>  
  
  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/members/{id}&quot;</span><span class="token punctuation">)</span>  
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">findMember</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Member</span> member<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> member<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>http://localhost:10080/members/1</code> 이렇게 사용자에게는 <code>id</code> 값을 넘겨 받지만 도메인 클래스 컨버터가 repository를 이용해 회원 엔티티를 찾아서 객체 반환</li> <li>트랜젝션이 없는 범위에서 엔티티를 조회했으므로, 엔티티를 변경해도 DB에 반영되지 않으므로 <strong>조회용으로만 사용해야 함</strong></li></ul> <br> <h2 id="_4-web-확장-페이징과-정렬"><a href="#_4-web-확장-페이징과-정렬" class="header-anchor">#</a> 4. Web 확장 - 페이징과 정렬</h2> <h3 id="페이징과-정렬-예제"><a href="#페이징과-정렬-예제" class="header-anchor">#</a> 페이징과 정렬 예제</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/members&quot;</span><span class="token punctuation">)</span>   
<span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">return</span> page<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li>파라미터로 <code>Pageable</code>을 받아서 페이지 SpringMVC paging 사용이 가능</li> <li>실제로는 <code>org.springframework.data.domain.PageRequest</code> 객체를 생성하여 사용</li></ul> <h3 id="요청-파라미터"><a href="#요청-파라미터" class="header-anchor">#</a> 요청 파라미터</h3> <ul><li>eg. <code>/members?page=0&amp;size=3&amp;sort=id,desc&amp;sort=username,desc</code></li> <li>page: 현재 페이지, 0부터 시작</li> <li>size: 한 페이지에 노출할 데이터 건수</li> <li>sort: 정렬 조건을 정의</li></ul> <h3 id="기본값"><a href="#기본값" class="header-anchor">#</a> 기본값</h3> <h4 id="글로벌-설정-스프링-부트-환경-설정값"><a href="#글로벌-설정-스프링-부트-환경-설정값" class="header-anchor">#</a> 글로벌 설정 - 스프링 부트 환경 설정값</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>  
  <span class="token key atrule">data</span><span class="token punctuation">:</span>  
    <span class="token key atrule">web</span><span class="token punctuation">:</span>  
      <span class="token key atrule">pageable</span><span class="token punctuation">:</span>  
        <span class="token key atrule">default-page-size</span><span class="token punctuation">:</span> <span class="token number">10</span>  
        <span class="token key atrule">max-page-size</span><span class="token punctuation">:</span> <span class="token number">200</span> 
</code></pre></div><h4 id="개별-설정-pageabledefault"><a href="#개별-설정-pageabledefault" class="header-anchor">#</a> 개별 설정 - <code>@PageableDefault</code></h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/members&quot;</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Chap5Member</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PageableDefault</span><span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> sort <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Chap5Member</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">return</span> page<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><h3 id="접두사"><a href="#접두사" class="header-anchor">#</a> 접두사</h3> <ul><li>페이징 정보가 둘 이상이면 접두사로 구분</li> <li><code>@Qualifier</code>에 접두사명 추가 &quot;{접두사명}_xxx&quot;</li> <li>eg. <code>/members?member_page=0&amp;order_page=1</code></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">list</span><span class="token punctuation">(</span>  
	<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;member&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Pageable</span> memberPageable<span class="token punctuation">,</span>   
  <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Pageable</span> orderPageable<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="page-내용을-dto로-변환"><a href="#page-내용을-dto로-변환" class="header-anchor">#</a> Page 내용을 DTO로 변환</h3> <ul><li><p>외부에 노출되는 API의 경우 API 스펙이 변경되면 안됨<br>
엔티티를 DTO로 변환해서 반환해야 함</p></li> <li><p>Page가 지원하는 <code>map()</code>을 사용해 다른 객체로 매핑 가능</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/members&quot;</span><span class="token punctuation">)</span>  
<span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberDto</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> memberRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">MemberDto</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="page를-1부터-시작하기"><a href="#page를-1부터-시작하기" class="header-anchor">#</a> Page를 1부터 시작하기</h3> <ul><li>SpringData는 Page를 0부터 시작</li> <li>1부터 시작하려면?
<ul><li>Pageable, Page를 사용하는게 아닌 Custom Class 생성</li> <li><code>spring.data.web.pageable.one-indexed-parameters</code> 를 true 로 설정<br>
그런데 이 방법은 web에서 page 파라미터를 -1 처리 할 뿐이므로 응답값인 Page 에 모두 0 페이지 인덱스를 기준으로 값을 반환하는 한계가 있음</li></ul></li></ul> <br> <h1 id="_6-스프링-데이터-jpa-구현체-분석"><a href="#_6-스프링-데이터-jpa-구현체-분석" class="header-anchor">#</a> 6. 스프링 데이터 JPA 구현체 분석</h1> <h2 id="_1-스프링-데이터-jpa-구현체-분석"><a href="#_1-스프링-데이터-jpa-구현체-분석" class="header-anchor">#</a> 1. 스프링 데이터 JPA 구현체 분석</h2> <p><code>org.springframework.data.jpa.repository.support.SimpleJpaRepository</code></p> <ul><li><code>@Repository</code> 적용
<ul><li>Spring Bean의 Componant scan 대상이 됨</li> <li>JDBC, JPA의 예외를 스프링이 추상화한 예외로 변환<br>
-&gt; 하부 구현 기술이 바뀌어도 기존 비즈니스 로직에 영향을 주지 않음</li></ul></li> <li><code>@Transactional(readOnly = true)</code> 클래스 레벨의 설정
<ul><li>데이터를 단순히 조회만 하고 변경하지 않는 트랜잭션에서 readOnly = true 옵션을 사용하면 플러시를 생략해서 약간의 성능 향상을 얻을 수 있음</li> <li>자세한 내용은 JPA 책 15.4.2 읽기 전용 쿼리의 성능 최적화 참고</li></ul></li> <li><code>@Transactional</code> 트랜잭션 적용
<ul><li>JPA의 모든 변경은 트랜잭션 안에서 동작</li> <li>스프링 데이터 JPA는 변경(등록, 수정, 삭제) 메서드를 트랜잭션 처리</li> <li>서비스 계층에서 트랜잭션을 시작하지 않으면 리파지토리 계층에서 트랜잭션 시작</li> <li>서비스 계층에서 트랜잭션을 시작하면 리파지토리는 해당 트랜잭션을 전파 받아서 사용<br>
-&gt; 스프링 데이터 JPA를 사용할 때 트랜잭션이 없어도 데이터 등록, 변경이 가능</li></ul></li> <li><strong>매우 중요!!!</strong> <code>save() 메서드</code> <ul><li>새로운 엔티티면 저장 ( persist )</li> <li>새로운 엔티티가 아니면 병합 ( merge )<br>
DB에서 데이터를 가져와서 현재 값으로 바꿔치기 : DB select 쿼리가 무조건 1회는 필요하기 때문에 성능에 영향이 있을 수 있어서 <strong>가급적 사용하지 않는게 좋음</strong></li></ul></li></ul> <br> <h2 id="_2-새로운-엔티티를-구별하는-방법"><a href="#_2-새로운-엔티티를-구별하는-방법" class="header-anchor">#</a> 2. 새로운 엔티티를 구별하는 방법</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> <span class="token string">&quot;Entity must not be null.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>entityInformation<span class="token punctuation">.</span><span class="token function">isNew</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// isNew 판단로직은 아래의 예시 참고</span>
			em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// id가 GeneratedValue 인 경우 아직 생성되지 않음</span>
			<span class="token keyword">return</span> entity<span class="token punctuation">;</span>  <span class="token comment">// persist 메서드가 실행된 이후에 id가 생성됨</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 새로운 엔티티를 판단 전략 예시</span>
<span class="token comment">// org.springframework.data.repository.core.support.AbstractEntityInformation</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isNew</span><span class="token punctuation">(</span><span class="token class-name">T</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">ID</span> id <span class="token operator">=</span> <span class="token function">getId</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">&gt;</span></span> idType <span class="token operator">=</span> <span class="token function">getIdType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>idType<span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token keyword">instanceof</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0L</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported primitive id type %s!&quot;</span><span class="token punctuation">,</span> idType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>새로운 엔티티를 판단(<code>isNew()</code>)하는 기본 전략</p> <ul><li><p>식별자가 객체일 때 <code>null</code>로 판단</p></li> <li><p>식별자가 자바 기본 타입일 때 <code>0</code>으로 판단</p></li> <li><p><code>Persistable</code> 인터페이스를 구현해서 판단 로직 변경 가능</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Persistable</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  	<span class="token class-name">ID</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token keyword">boolean</span> <span class="token function">isNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <blockquote><p>참고</p> <ul><li><p>JPA 식별자 생성 전략이 <code>@GenerateValue</code> 면 save() 호출 시점에 식별자가 없으므로 새로운 엔티 티로 인식해서 정상 동작한다.<br>
그런데 JPA 식별자 생성 전략이 <code>@Id</code> 만 사용해서 직접 할당이면 이미 식별자 값이 있는 상태로 save() 를 호출한다. 따라서 이 경우 merge() 가 호출된다. merge() 는 우선 DB를 호출해서 값을 확인하고, DB에 값이 없으면 새로운 엔티티로 인지하므로 매우 비효율 적이다.<br>
따라서 Persistable 를 사용해서 새로운 엔티티 확인 여부를 직접 구현하게는 효과적이다.</p></li> <li><p>참고로 등록시간( @CreatedDate )을 조합해서 사용하면 이 필드로 새로운 엔티티 여부를 편리하게 확인할 수 있다. (@CreatedDate에 값이 없으면 새로운 엔티티로 판단)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@NoArgsConstructor</span><span class="token punctuation">(</span>access <span class="token operator">=</span> <span class="token class-name">AccessLevel</span><span class="token punctuation">.</span>PROTECTED<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token keyword">implements</span> <span class="token class-name">Persistable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@CreatedDate</span>  <span class="token comment">// JPA event</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createdDate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> createdDate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></blockquote> <br> <h1 id="_7-나머지-기능들"><a href="#_7-나머지-기능들" class="header-anchor">#</a> 7. 나머지 기능들</h1> <h2 id="_1-specification-명세"><a href="#_1-specification-명세" class="header-anchor">#</a> 1. Specification (명세)</h2> <blockquote><p>DB 쿼리에서 사용하는 Where 문 내의 and, or와 같은 조건을 넣어주는걸 언어와 상관없이 조립해서 repository에 던지면 쿼리로 넘어가게 사용할 수 있도록 추상화한 개념<br>
SpringData JPA는 Criteria를 활용해서 이 개념을 사용할 수 있도록 지원<br>
가독성이 안좋으므로 실무에서 사용은 <strong>비추</strong></p></blockquote> <h3 id="술어-predicate"><a href="#술어-predicate" class="header-anchor">#</a> 술어 (predicate)</h3> <ul><li>참 또는 거짓으로 평가</li> <li>AND OR 같은 연산자로 조합, 다양한 검색 조건을 쉽게 생성</li> <li>스프링 데이터 JPA는 <code>org.springframework.data.jpa.domain.Specification</code> 클래스로 정의</li></ul> <h3 id="명세-기능-사용-방법"><a href="#명세-기능-사용-방법" class="header-anchor">#</a> 명세 기능 사용 방법</h3> <br> <h2 id="_2-query-by-example"><a href="#_2-query-by-example" class="header-anchor">#</a> 2. Query By Example</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>  
<span class="token annotation punctuation">@Transactional</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryByExampleTest</span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@Autowired</span>  
  <span class="token class-name">MemberRepository</span> memberRepository<span class="token punctuation">;</span>  
  <span class="token annotation punctuation">@Autowired</span>  
  <span class="token class-name">EntityManager</span> em<span class="token punctuation">;</span>  

  <span class="token annotation punctuation">@Test</span>  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">basic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>  
    <span class="token class-name">Team</span> teamA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Team</span><span class="token punctuation">(</span><span class="token string">&quot;teamA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>teamA<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
    em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;m1&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> teamA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;m2&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> teamA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    em<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Probe 생성  </span>
    <span class="token class-name">Member</span> member <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;m1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token class-name">Team</span> team <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Team</span><span class="token punctuation">(</span><span class="token string">&quot;teamA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//내부조인으로 teamA 가능      </span>
    member<span class="token punctuation">.</span><span class="token function">setTeam</span><span class="token punctuation">(</span>team<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
    <span class="token comment">//ExampleMatcher 생성, age 프로퍼티는 무시  </span>
    <span class="token class-name">ExampleMatcher</span> matcher <span class="token operator">=</span> <span class="token class-name">ExampleMatcher</span><span class="token punctuation">.</span><span class="token function">matching</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIgnorePaths</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token class-name">Example</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> example <span class="token operator">=</span> <span class="token class-name">Example</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>member<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
    <span class="token function">assertThat</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre></div><ul><li>Probe : 필드에 데이터가 있는 실제 도메인 객체</li> <li>ExampleMatcher: 특정 필드를 일치시키는 상세한 정보 제공, 재사용 가능</li> <li>Example: Probe와 ExampleMatcher로 구성, 쿼리를 생성하는데 사용</li></ul> <h3 id="장점"><a href="#장점" class="header-anchor">#</a> 장점</h3> <ul><li>동적 쿼리를 편하게 처리</li> <li>도메인 객체를 그대로 사용</li> <li>데이터 저장소 RDB에서 NOSQL로 변경해도 코드 변경이 없게 추상화 되어 있음</li> <li><code>JpaRepository</code> 인터페이스에 이미 포함 (<code>JpaRepository</code>가 상속하는 <code>QueryByExampleExecutor&lt;T&gt;</code> 에서 구현)</li></ul> <h3 id="단점"><a href="#단점" class="header-anchor">#</a> 단점</h3> <ul><li>join에서 완벽한 해결이 어려움 (INNER JOIN만 가능, LEFT JOIN 불가)</li> <li>중첩 제약조건 불가
<ul><li><code>firstname = ?0 or (firstname = ?1 and lastname = ?2)</code></li></ul></li> <li>매칭 조건이 단순
<ul><li>문자는 starts/contains/ends/regex</li> <li>다른속성은정확한매칭( = )만지원</li></ul></li></ul> <br> <h2 id="_3-projection"><a href="#_3-projection" class="header-anchor">#</a> 3. Projection</h2> <p>Entity 대신 DTO를 편리하게 조회할 때 사용<br>
전체 엔티티가 아니라 특정 필드를 조회하고 싶은 경우에 사용 가능</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UsernameOnly</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>조회할 엔티티의 필드를 getter 형식으로 지정하면 해당 필드만 선택해서 조회</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">{</span>  
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UsernameOnly</span><span class="token punctuation">&gt;</span></span> <span class="token function">findProjectionsByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>메서드 이름은 자유, 반환 타입으로 조회할 필드를 인지</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token annotation punctuation">@Test</span>  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">projections</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>  
    <span class="token comment">//given  </span>
    <span class="token class-name">Team</span> teamA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Team</span><span class="token punctuation">(</span><span class="token string">&quot;teamA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>teamA<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token class-name">Member</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;m1&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> teamA<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">Member</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Member</span><span class="token punctuation">(</span><span class="token string">&quot;m2&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> teamA<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
    em<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    em<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UsernameOnly</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findProjectionsByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;m1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    
    <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>  

<span class="token comment">/*   
디버깅 모드에서 username 조회하는 쿼리 확인  
select m.username from member m   
where m.username=‘m1’;  
*/</span>  
</code></pre></div></li></ul> <h3 id="인터페이스-기반-projection"><a href="#인터페이스-기반-projection" class="header-anchor">#</a> 인터페이스 기반 Projection</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Closed Projection  </span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UsernameOnly</span> <span class="token punctuation">{</span>  
   <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token comment">// Open Projection  </span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UsernameOnly</span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{target.username + ' ' + target.age + ' ' + target.team.name}&quot;</span><span class="token punctuation">)</span>  
  <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
</code></pre></div><ul><li>Open projection 사용시 DB에서 entity 필드를 모두 조회해온 다음에 계산<br>
-&gt; JPQL SELECT 절 최적화가 안됨</li></ul> <h3 id="클래스-기반-projection"><a href="#클래스-기반-projection" class="header-anchor">#</a> 클래스 기반 Projection</h3> <p>구체적인 DTO 형식을 사용해서 생성자의 파라미터 이름으로 매칭</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsernameOnlyDto</span> <span class="token punctuation">{</span>  
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>  
     
   <span class="token keyword">public</span> <span class="token class-name">UsernameOnlyDto</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 생성자의 parameter 이름으로 필드 매칭</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>
      
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     <span class="token keyword">return</span> username<span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
 <span class="token punctuation">}</span>
</code></pre></div><h3 id="동적-projections"><a href="#동적-projections" class="header-anchor">#</a> 동적 Projections</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findProjectionsByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UsernameOnly</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> memberRepository<span class="token punctuation">.</span><span class="token function">findProjectionsByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;m1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UsernameOnly</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="중첩-구조-처리"><a href="#중첩-구조-처리" class="header-anchor">#</a> 중첩 구조 처리</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NestedClosedProjection</span> <span class="token punctuation">{</span>  
  <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token class-name">TeamInfo</span> <span class="token function">getTeam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">interface</span> <span class="token class-name">TeamInfo</span> <span class="token punctuation">{</span>  
    <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

</code></pre></div><ul><li><p>호출되는 쿼리</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span>  
  m<span class="token punctuation">.</span>username <span class="token keyword">as</span> col_0_0_<span class="token punctuation">,</span>   
  t<span class="token punctuation">.</span>teamid <span class="token keyword">as</span> col_1_0_<span class="token punctuation">,</span>  
  t<span class="token punctuation">.</span>teamid <span class="token keyword">as</span> teamid1_2_<span class="token punctuation">,</span>  
  t<span class="token punctuation">.</span>name <span class="token keyword">as</span> name2_2_  
<span class="token keyword">from</span>  
	member m  
<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span>  
	team t  
	  <span class="token keyword">on</span> m<span class="token punctuation">.</span>teamid<span class="token operator">=</span>t<span class="token punctuation">.</span>teamid  
<span class="token keyword">where</span>  
	m<span class="token punctuation">.</span>username<span class="token operator">=</span>?
</code></pre></div></li></ul> <h3 id="주의"><a href="#주의" class="header-anchor">#</a> <strong>주의</strong></h3> <ul><li>프로젝션 대상이 root 엔티티면, JPQL SELECT 절 최적화 가능</li> <li>프로젝션 대상이 ROOT가 아니면
<ul><li>LEFT OUTER JOIN 처리</li> <li>모든 필드를 SELECT해서 엔티티로 조회한 다음에 계산</li></ul></li></ul> <h3 id="정리"><a href="#정리" class="header-anchor">#</a> 정리</h3> <ul><li>프로젝션 대상이 root 엔티티면 유용</li> <li>프로젝션 대상이 root 엔티티를 넘어가면 JPQL SELECT 최적화가 안됨</li> <li>실무의 복잡한 쿼리를 해결하기에는 한꼐가 있음</li> <li>실무에서 단순할 때만 사용하고, 복잡해지면 QueryDsl 사용 추천</li></ul> <br> <h2 id="_4-네이티브-쿼리"><a href="#_4-네이티브-쿼리" class="header-anchor">#</a> 4. 네이티브 쿼리</h2> <p>SQL 쿼리를 직접 짜서 사용<br>
가급적 사용하지 않는 것이 좋음</p> <h3 id="spring-data-jpa-기반-네이티브-쿼리"><a href="#spring-data-jpa-기반-네이티브-쿼리" class="header-anchor">#</a> Spring Data JPA 기반 네이티브 쿼리</h3> <ul><li>페이징 지원</li> <li>반환 타입
<ul><li>Object[]</li> <li>Tuple</li> <li>DTO (Spring Data Interface Projections 지원)</li></ul></li> <li>제약
<ul><li>Sort 파라미터를 통한 정렬이 정상 동작하지 않을 수 있음</li> <li>JPQL 처럼 어플리케이션 로딩 시점에 문법 확인 불가</li> <li>동적 쿼리 불가</li></ul></li></ul> <h3 id="jpa-네이티브-sql-지원"><a href="#jpa-네이티브-sql-지원" class="header-anchor">#</a> JPA 네이티브 SQL 지원</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MemberRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Member</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
  <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from member where username = ?&quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span>
  <span class="token boolean">true</span><span class="token punctuation">)</span>  
  <span class="token class-name">Member</span> <span class="token function">findByNativeQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>네이티브 SQL을 DTO로 조회할 때는 JdbcTemplate or myBatis 권장</strong></li> <li>JPQL은 위치 기반 파리미터를 1부터 시작하지만 네이티브 SQL은 0부터 시작</li> <li>네이티브 SQL을 엔티티가 아닌 DTO로 변환은 하려면
<ul><li>DTO 대신 JPA TUPLE 조회</li> <li>DTO 대신 MAP 조회</li> <li>@SqlResultSetMapping -&gt; 복잡</li> <li>Hibernate ResultTransformer를 사용해야함 -&gt; 복잡</li> <li>https://vladmihalcea.com/the-best-way-to-map-a-projection-query-to-a-dto-with-jpa-and-hibernate/</li></ul></li></ul> <h3 id="projections-활용"><a href="#projections-활용" class="header-anchor">#</a> Projections 활용</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;SELECT m.member_id as id, m.username, t.name as teamName FROM member m left join team t&quot;</span><span class="token punctuation">,</span>
              countQuery <span class="token operator">=</span> <span class="token string">&quot;SELECT count(*) from member&quot;</span><span class="token punctuation">,</span>
              nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberProjection</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByNativeProjection</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="동적-네이티브-쿼리"><a href="#동적-네이티브-쿼리" class="header-anchor">#</a> 동적 네이티브 쿼리</h3> <ul><li>Hibernate를 직접 활용</li> <li>스프링 JdbcTemplate, MyBatis, jooq 같은 외부 라이브러리 사용</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.14df79b1.js" defer></script><script src="/TIL/assets/js/2.dce8ba1c.js" defer></script><script src="/TIL/assets/js/63.01eebdae.js" defer></script>
  </body>
</html>
