

# 1장. 도메인 모델 시작

## 목차

1. [도메인](#도메인)
2. [도메인 모델](#도메인-모델)
3. [도메인 모델 패턴](#도메인-모델-패턴)
4. [도메인 모델 도출](#도메인-모델-도출)
5. [엔티티와 밸류](#엔티티와 밸류)
6. [도메인 용어](#도메인-용어)

---

## 도메인

소프트웨어로 해결하고자 하는 문제영역을 **도메인**이라고 한다.  
도메인은 하위 도메인으로 이루어 지기도 하는데, 예를 들어 주문이라는 도메인에는 혜택, 결제, 배송, 정산이라는 하위 도메인이 존재한다. 그러나 모든 도메인이 하위 도메인이 존재하는 것은 아니므로, 상황에 따라 하위 도메인 구성을 판단하면 된다.

<br>

## 도메인 모델

특정 도메인을 개념적으로 표현한 것을 **도메인 모델**이라고 한다.  
도메인을 이해하기 위해서는 제공하는 기능과 도메인의 주요 데이터 구성을 파악해야 하는데, 이런 면에서 기능과 데이터를 함께 보여주는 객체 모델은 도메인을 모델링하기에 적합하다.  
도메인 모델을 모델링 하는 방법은 객체 모델 외에도 상태 다이어그램이나 UML 표기기법 외에도 그래프(관계가 중요한 도메인일 시), 수학 공식(계산 규칙이 중요한 도메인일 시)을 이용해서 도메인을 모델링할 수 있다.  
도메인 모델은 표현 방식이 중요한 것이 아니라 도메인을 잘 이해할 수 있도록 하는 개념 모델이다.  
개념 모델은 바로 코드를 작성하기에 적합하지 않으므로 개념 모델을 최대한 따르는 **구현 모델**이 추가적으로 필요하다.

<br>

## 도메인 모델 패턴

일반적인 어플리케이션 아키텍처는 네 개의 계층으로 나뉜다.

* 표현 - 사용자의 요청을 처리, 응답
* 응용 - 직덥 도메인 로직을 가지지 않고 도메인 계층을 조합해서 사용자 요청에 대한 기능을 실행
* 도메인 - 시스템이 제공할 도메인의 규칙을 구현
* 인프라스트럭처 - DB와 같은 외부 시스템과 연동

<br>

## 도메인 모델 도출

개발자들은 기획서, 유즈케이스, 사용자 스토리 등을 통해 요구사항의 도메인을 이해한 후에 이를 통해 도메인 모델을 만들고 개발을 시작해야 한다.  
도메인 모델링의 기본 작업?

* 모델을 구성하는 핵심요소, 규칙, 기능을 찾기

<br>

## 엔티티와 밸류

도메인 모델은 두가지로 구분할 수 있음  

### Entity

* 식별자를 가진다는 것이 큰 특징
* 식별자는 바뀌지 않고 고유함
  * 엔티티를 구현한 클래스는 식별자를 이용해 equals(), hashCode()메서드를 구현할 수 있음

#### Entity 식별자 생성

Entity 식별자를 생성하는 시점은 도메인의 특징과 사용하는 기술에 따라 달라진다.  

* 특정 규칙에 따라 생성
* UUID(Universally Unique Identifier) 사용
  * 다수의 개발 언어는 UUID 생성기를 제공
* 값을 직접 입력
  * e.g.) 회원 아이디 / 이메일 : 중복 케이스 발생 가능성이 있으므로 중복 입력을 막는 로직이 필요
* 일련번호 사용(시퀀스 / DB auto increment)



### Value type

Value type은 개념적으로 완전한 하나(!??!?!!!)를 표현할 떄 사용

**Bad :**

```java
public class ShippingInfo {
  // 받는 사람
  private String receiverName;
  private String receiverPhoneNumber;
  
  // 주소
  private String shippingAddress1; 
  private String shippingAddress2;
  private String shippingZipcode;
  
  ...
}
```

**Good : 받는 사람, 주소 자체가 하나의 도메인 개념이므로 Value type을 사용함으로써 개념적으로 온전한 하나의 도메인을 표현**  

```java
public class Receiver {
  private String name;
  private String phoneNumber;
  
  ...
}

public class Address {
  private String address1; 
  private String address2;
  private String zipcode;
  
  ...
}

public class ShippingInfo {
  private Receiver receiver;
  private Address address;
  
  ...
}
```

**Value type의 장점**  

* 해당 데이터(값/변수)의 도메인(개념/의미)을 명확하게 명시할 수 있음
* 해당 Value type을 위한 기능 추가 가능

**Value type 사용시 특징**

* 데이터 변경 시 해당 인스턴스의 값을 변경하는 것이 아닌 변경 할 값을 가지는 새로운 인스턴스를 생성하는 방식을 선호 -> 불변 객체로 사용하라!
  * 의도치 않은 곳에서 데이터가 변경되는 것을 방지하기 위함
* Value 객체 비교 시, 모든 속성이 같은지 비교해야 함



### 엔티티 식별자와 밸류 타입

일반적으로 식별자는 String 타입이지만, 식별자가 도메인 특성을 가지는 경우 식별자를 위한 Value type을 사용해서 의미가 잘 드러나도록 한다.  



### 도메인 모델에 set 메서드 넣지 않기

* get/set 메서드로 인해(특히 **set!**) 값이 어디서든 바뀔 수 있기 때문에 도메인 핵심 개념이나 의도가 코드에서 사라지게 됨
* 기본 생성자에 set 메서드로 값을 전달하다보면 객체 내부에 누락되는 데이터가 존재할 수 있음
  * 도메인 객체는 생성 시점에 필요한 것을 전달!

<br>

## 도메인 용어

도메인에서 사용하는 용어는 코드에 그대로 사용해야 가독성도 좋아지고 버그도 줄어들게 된다.  

