# 1장. 아키텍처 개요

## 목차

1. [아키텍처 개요](#아키텍처-개요)
2. [계층 구조 아키텍처](#계층-구조-아키텍처)
3. [DIP](#DIP)
4. [DIP 주의사항](#DIP-주의사항)
5. [DIP와 아키텍처](#DIP와-아키텍처)

---

## 아키텍처 개요

### 아키텍처 영역

* 표현 영역
  * UI 영역이라고도 함
  * 사용자의 요청을 받아 응용 영역에 전달
  * 응용 영역의 처리 결과를 사용자에게 보여줌
  * 스프링 MVC 프레임워크가 대표적인 기술
  
* 응용 영역
  
  * 도메인 영역을 이용해서 사용자에게 제공할 기술을 구현
  
* 도메인 영역 

  * 도메인 모델인 도메인의 핵심 로직을 구현

* 인프라스트럭처 영역

  * 구현 기술에 대한 것을 다룸
  * 논리적인 개념 표현 보다는 실제 구현을 다룸
  * 도메인, 응용, 표현 영역에서 사용할 기능을 제공

<br>

## 계층 구조 아키텍처

### 표현 -> 응용 -> 도메인 -> 인프라스트럭쳐

계층 구조 아키텍처는 왼쪽에서 오른쪽의 순서로 계층 구조를 가진다.  
계층 구조의 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않음  
엄격한 계층 구조는 바로 아래의 계층에만 의존을 가져야 하지만 실질적으로 표현, 응용, 도메인은 인프라스트럭쳐 영역에서 상세하게 구현한 기술을 가져다 쓰기 때문에 **모든 영역에 인프라스트럭쳐 영역에 의존**이 존재한다. 이로인해 **테스트 어려움**과 **기능 확장의 어려움**이 존재한다.

<br>

## DIP

**Dependency Inversion Principle, 의존 역전 원칙**

단일 기능을 제공하는 **고수준 모듈**은 여러 하위 기능을 구현한 **저수준 모듈**이 필요  
그러나 고수준 모듈이 저수준 모듈을 사용하여 기능 구현 시 테스트 어려움과 확장의 어려움이 발생  
이를 해결하기 위해 **추상화 한 인터페이스를 통해 저수준 모듈이 고수준 모듈을 의존**하도록 함

고수준 모듈의 추상화를 통해 테스트 시에도 대용 객체를 사용하여 테스트가 가능해 짐  

```java
public class CalculateDiscountServiceTest {
  @Test(expect = NoCustomerException.class)
  public void noCustomer_thenExceptionShouldBeThrown() {
    // 테스트 목적의 대용 객체
    CustomerRepository stubRepo = mock(CustomerRepository.class);
    when(stubRepo.findById("noCustId")).thenReturn(null);
    
    RuleDiscounter stubRule = (cust, lines) -> null;
    
    // 대용 객체를 주입받아 테스트 진행
    CalculateDiscountService calDisSvc = new CalculateDiscountService(stubRepo, stubRule);
    calDisSvc.calculateDiscount(someLines, "noCustId");
  }
}
```

<br>

## DIP 주의사항

DIP를 적용할 떄 **하위 기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출**해야 함  

<br>

## DIP와 아키텍처

아키텍처에 DIP를 적용하면 인프라스트럭처 영역이 응용/도메인 영역을 의존(상속)  
인프라스트럭처 영역의 기술이 바뀌더라도 응용/도메인 영역에 영향을 끼치지 않을 수 있음  
(e.g., DB의 종류를 바꾸더라도 Repository 클래스만 추가 해 주면 됨, MySqlRepository -> HBaseRepository)

