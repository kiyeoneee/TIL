# JVM에서 thread dump 가져오기

장애상황 : 쉘스크립트로 전체 서버의 프로세스를 내리는 작업을 진행하던 중 스크립트가 멈춤
원인 : 서버의 응답이 없었음, 해당 서버에 접속해서 로그를 확인했을 때 딱히 문제는 없어 보였으나 스레드 덤프를 뜬 파일을 보니 문제 발생 -> 서버 로드 증가 -> 모든 프로세스가 응답 시간이 느려지다 못해 대답을 못함 -> 행업 임으로 추측이 됨

이러한 경우 쓰레드 덤프를 떠서 확인해보라는 키워드를 받아 트러블 슈팅한 내용을 기록한다.

<br>

### 스레드 덤프를 추출해보면 좋을 상황

* 모든 시스템에 응답이 없을 때
* 사용자 수가 많지 않은데 CPU사용량이 높을때
* 특정어플리케이션 수행 시 응답이 없을때
* 간헐적으로 응답이 느릴때
* 서비스 실행시간이 길어질수록 응답시간이나 cpu 사용량이 늘어날 때
* 등등

<br>

### 스레드 덤프를 추출하는 방법

```
OS 단에서
	리눅스 : kill -3 [PID]
java단에서 
	jps -v 로 java 프로세스 확인
	- jstack [PID] (jstack으로 반응이 없는 경우 –F 옵션)
	- jcmd [PID] Thread.print (jdk7 이후 등장)
		jcmd [PID] help 로 명령어 확인 가능, 직관적임
```

<br>

### 스레드 덤프 읽기

스레드 덤프를 그대로 읽기는 어렵다.
스레드 덤프를 파일로 저장하여 시각화 시켜주는 사이트를 사용하는 것이 더욱 용이
	eg) [JVM Thread dump analyzer - Universal Java Thread dump analysis](http://fastthread.io/) 

